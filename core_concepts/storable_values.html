<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Storable Values &#8212; simple_app_state 2026 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=27fed22d" />
    <script src="../_static/documentation_options.js?v=fc6fd62b"></script>
    <script src="../_static/doctools.js?v=fd6eb6e6"></script>
    <script src="../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Batch Updates" href="batch_updates.html" />
    <link rel="prev" title="Value Semantics" href="value_semantics.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="storable-values">
<h1>Storable Values<a class="headerlink" href="#storable-values" title="Link to this heading">¶</a></h1>
<p>This chapter explains <strong>what kinds of values can be safely stored</strong>
in <strong>SimpleAppState</strong> slots, and how to handle custom classes correctly.</p>
<p>Understanding these rules is essential for:</p>
<ul class="simple">
<li><p>predictable rebuild behavior</p></li>
<li><p>correct undo / redo</p></li>
<li><p>reliable persistence</p></li>
<li><p>avoiding subtle runtime errors</p></li>
</ul>
<p>If you only store primitive values, you can skim this chapter.
If you want to store your own classes, read it carefully.</p>
<hr class="docutils" />
<section id="the-core-rule">
<h2>The Core Rule<a class="headerlink" href="#the-core-rule" title="Link to this heading">¶</a></h2>
<p><strong>All values stored in SimpleAppState must be safely deep-copyable.</strong></p>
<p>SimpleAppState enforces <strong>value semantics</strong>.
Every value is copied on:</p>
<ul class="simple">
<li><p>slot definition</p></li>
<li><p>set / update</p></li>
<li><p>get</p></li>
<li><p>snapshot / restore</p></li>
</ul>
<p>If a value cannot be deep-copied safely,
it cannot be used as application state.</p>
</section>
<hr class="docutils" />
<section id="values-that-work-out-of-the-box">
<h2>Values That Work Out of the Box<a class="headerlink" href="#values-that-work-out-of-the-box" title="Link to this heading">¶</a></h2>
<p>The following values are supported <strong>without any additional work</strong>:</p>
<ul class="simple">
<li><p>primitive values
(<cite>int</cite>, <cite>double</cite>, <cite>bool</cite>, <cite>String</cite>, <cite>null</cite>)</p></li>
<li><p>Lists composed recursively of supported values</p></li>
<li><p>Maps composed recursively of supported values</p></li>
</ul>
<p>Examples:</p>
<div class="highlight-dart notranslate"><div class="highlight"><pre><span></span><span class="kd">final</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">appState</span><span class="p">.</span><span class="n">slot</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">,</span><span class="w"> </span><span class="nl">initial:</span><span class="w"> </span><span class="m">0</span><span class="p">);</span>

<span class="kd">final</span><span class="w"> </span><span class="n">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">appState</span><span class="p">.</span><span class="n">slot</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;&gt;</span><span class="p">(</span>
<span class="w">  </span><span class="s1">&#39;tags&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nl">initial:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">  </span><span class="nl">caster:</span><span class="w"> </span><span class="p">(</span><span class="n">raw</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">raw</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">List</span><span class="p">).</span><span class="n">cast</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">(),</span>
<span class="p">);</span>

<span class="kd">final</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">appState</span><span class="p">.</span><span class="n">slot</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="kt">dynamic</span><span class="o">&gt;&gt;</span><span class="p">(</span>
<span class="w">  </span><span class="s1">&#39;config&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nl">initial:</span><span class="w"> </span><span class="p">{},</span>
<span class="w">  </span><span class="nl">caster:</span><span class="w"> </span><span class="p">(</span><span class="n">raw</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">raw</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Map</span><span class="p">).</span><span class="n">cast</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="kt">dynamic</span><span class="o">&gt;</span><span class="p">(),</span>
<span class="p">);</span>
</pre></div>
</div>
<p>These values are:</p>
<ul class="simple">
<li><p>immutable or safely copied</p></li>
<li><p>JSON-serializable in principle</p></li>
<li><p>safe for persistence and undo / redo</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="when-you-need-a-custom-class">
<h2>When You Need a Custom Class<a class="headerlink" href="#when-you-need-a-custom-class" title="Link to this heading">¶</a></h2>
<p>If a value <strong>cannot be represented purely</strong> using primitives,
Lists, and Maps, it <strong>must</strong> be wrapped in a custom class.</p>
<p>Typical examples that <strong>require</strong> a custom class:</p>
<ul class="simple">
<li><p><cite>DateTime</cite></p></li>
<li><p><cite>Color</cite></p></li>
<li><p><cite>Offset</cite>, <cite>Rect</cite>, <cite>Size</cite></p></li>
<li><p>Any Flutter framework class</p></li>
<li><p>Domain objects with identity or behavior</p></li>
</ul>
<p>Typical examples that <strong>do not</strong> require a custom class:</p>
<ul class="simple">
<li><p><cite>int</cite>, <cite>double</cite>, <cite>bool</cite>, <cite>String</cite></p></li>
<li><p><cite>List&lt;String&gt;</cite></p></li>
<li><p><cite>Map&lt;String, dynamic&gt;</cite> composed only of primitives</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="cloneablefile">
<h2>CloneableFile<a class="headerlink" href="#cloneablefile" title="Link to this heading">¶</a></h2>
<p>Any custom class stored in a slot <strong>must extend</strong>
<a class="reference external" href="https://pub.dev/documentation/file_state_manager/latest/file_state_manager/CloneableFile-class.html">CloneableFile</a>
from the <cite>file_state_manager</cite> package.</p>
<p>This allows SimpleAppState to:</p>
<ul class="simple">
<li><p>deep-copy the value automatically</p></li>
<li><p>serialize it for persistence</p></li>
<li><p>restore it for undo / redo</p></li>
<li><p>detect structural changes reliably</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="required-methods">
<h2>Required Methods<a class="headerlink" href="#required-methods" title="Link to this heading">¶</a></h2>
<p>A class extending <strong>CloneableFile</strong> must implement <strong>all</strong> of the following:</p>
<section id="clone">
<h3>1. <strong>clone()</strong><a class="headerlink" href="#clone" title="Link to this heading">¶</a></h3>
<p>Returns a <strong>deep copy</strong> of the object.</p>
<ul class="simple">
<li><p>All properties must be copied</p></li>
<li><p>Nested <strong>CloneableFile</strong> objects must also be cloned</p></li>
<li><p>No references to the original object may remain</p></li>
</ul>
</section>
<section id="todict">
<h3>2. <strong>toDict()</strong><a class="headerlink" href="#todict" title="Link to this heading">¶</a></h3>
<p>Returns a <strong>Map&lt;String, dynamic&gt;</strong> representation.</p>
<p>The returned map may contain only:</p>
<ul class="simple">
<li><p>primitive values</p></li>
<li><p><strong>null</strong></p></li>
<li><p>Lists or Maps composed recursively of the above</p></li>
</ul>
<p>If a property is another custom object,
it must also extend <strong>CloneableFile</strong> and be converted via <strong>toDict()</strong>.</p>
</section>
<section id="factory-fromdict-map-string-dynamic-src">
<h3>3. <strong>factory fromDict(Map&lt;String, dynamic&gt; src)</strong><a class="headerlink" href="#factory-fromdict-map-string-dynamic-src" title="Link to this heading">¶</a></h3>
<p>Reconstructs the object from the dictionary produced by <strong>toDict()</strong>.</p>
<p>This method must:</p>
<ul class="simple">
<li><p>restore all properties</p></li>
<li><p>fully reconstruct the object</p></li>
<li><p>be deterministic</p></li>
</ul>
</section>
</section>
<hr class="docutils" />
<section id="strongly-recommended">
<h2>Strongly Recommended<a class="headerlink" href="#strongly-recommended" title="Link to this heading">¶</a></h2>
<p>Although not required, it is <strong>strongly recommended</strong> to override:</p>
<ul class="simple">
<li><p><strong>operator ==</strong></p></li>
<li><p><strong>hashCode</strong></p></li>
</ul>
<p>This ensures:</p>
<ul class="simple">
<li><p>correct equality comparison</p></li>
<li><p>predictable rebuild behavior</p></li>
<li><p>reliable undo / redo detection</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="example">
<h2>Example<a class="headerlink" href="#example" title="Link to this heading">¶</a></h2>
<p>A safe wrapper for <strong>DateTime</strong>:</p>
<div class="highlight-dart notranslate"><div class="highlight"><pre><span></span><span class="kd">class</span><span class="w"> </span><span class="nc">AppTimestamp</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">CloneableFile</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">epochMillis</span><span class="p">;</span>

<span class="w">  </span><span class="n">AppTimestamp</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">epochMillis</span><span class="p">);</span>

<span class="w">  </span><span class="kd">factory</span><span class="w"> </span><span class="n">AppTimestamp</span><span class="p">.</span><span class="n">fromDateTime</span><span class="p">(</span><span class="n">DateTime</span><span class="w"> </span><span class="n">dt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">AppTimestamp</span><span class="p">(</span><span class="n">dt</span><span class="p">.</span><span class="n">millisecondsSinceEpoch</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="n">DateTime</span><span class="w"> </span><span class="n">toDateTime</span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w">      </span><span class="n">DateTime</span><span class="p">.</span><span class="n">fromMillisecondsSinceEpoch</span><span class="p">(</span><span class="n">epochMillis</span><span class="p">);</span>

<span class="w">  </span><span class="nd">@override</span>
<span class="w">  </span><span class="n">AppTimestamp</span><span class="w"> </span><span class="n">clone</span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">AppTimestamp</span><span class="p">(</span><span class="n">epochMillis</span><span class="p">);</span>

<span class="w">  </span><span class="nd">@override</span>
<span class="w">  </span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="kt">dynamic</span><span class="o">&gt;</span><span class="w"> </span><span class="n">toDict</span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="s1">&#39;epochMillis&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">epochMillis</span><span class="p">,</span>
<span class="w">      </span><span class="p">};</span>

<span class="w">  </span><span class="kd">factory</span><span class="w"> </span><span class="n">AppTimestamp</span><span class="p">.</span><span class="n">fromDict</span><span class="p">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="kt">dynamic</span><span class="o">&gt;</span><span class="w"> </span><span class="n">src</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">AppTimestamp</span><span class="p">(</span><span class="n">src</span><span class="p">[</span><span class="s1">&#39;epochMillis&#39;</span><span class="p">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">int</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nd">@override</span>
<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="kd">operator</span><span class="w"> </span><span class="o">==</span><span class="p">(</span><span class="kt">Object</span><span class="w"> </span><span class="n">other</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w">      </span><span class="n">other</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">AppTimestamp</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">epochMillis</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">epochMillis</span><span class="p">;</span>

<span class="w">  </span><span class="nd">@override</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="kd">get</span><span class="w"> </span><span class="n">hashCode</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">epochMillis</span><span class="p">.</span><span class="n">hashCode</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This class is:</p>
<ul class="simple">
<li><p>safely copyable</p></li>
<li><p>serializable</p></li>
<li><p>undo / redo friendly</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="deep-copy-semantics">
<h2>Deep Copy Semantics<a class="headerlink" href="#deep-copy-semantics" title="Link to this heading">¶</a></h2>
<p>Classes extending <strong>CloneableFile</strong> are automatically deep-copied
by SimpleAppState, even when nested inside Lists or Maps.</p>
<p>Inside <strong>slot.update()</strong>:</p>
<ul class="simple">
<li><p>the value you receive is <strong>already a copy</strong></p></li>
<li><p>you must mutate it directly and return it</p></li>
<li><p><strong>do not</strong> create additional copies</p></li>
</ul>
<p>Example:</p>
<div class="highlight-dart notranslate"><div class="highlight"><pre><span></span><span class="n">timestampSlot</span><span class="p">.</span><span class="n">update</span><span class="p">((</span><span class="n">ts</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">ts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AppTimestamp</span><span class="p">.</span><span class="n">fromDateTime</span><span class="p">(</span><span class="n">DateTime</span><span class="p">.</span><span class="n">now</span><span class="p">());</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">ts</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="what-must-never-be-stored">
<h2>What Must Never Be Stored<a class="headerlink" href="#what-must-never-be-stored" title="Link to this heading">¶</a></h2>
<p>The following objects must <strong>never</strong> be stored in slots,
even if wrapped in a custom class:</p>
<ul class="simple">
<li><p><strong>BuildContext</strong></p></li>
<li><p><strong>FocusNode</strong></p></li>
<li><p><strong>Stream</strong> or <strong>Future</strong></p></li>
<li><p>callbacks or closures</p></li>
<li><p>controllers, animations, or UI handles</p></li>
<li><p>any object tied to the widget lifecycle</p></li>
</ul>
<p>These objects represent <strong>runtime behavior</strong>, not application state.</p>
</section>
<hr class="docutils" />
<section id="relation-to-refappstate">
<h2>Relation to RefAppState<a class="headerlink" href="#relation-to-refappstate" title="Link to this heading">¶</a></h2>
<p>If you need to store:</p>
<ul class="simple">
<li><p>very large objects</p></li>
<li><p>mutable graph-like structures</p></li>
<li><p>non-copyable engine-level data</p></li>
</ul>
<p>then <strong>SimpleAppState may not be appropriate</strong>.</p>
<p>In such cases, see:
<a class="reference internal" href="../state_models/ref_app_state.html"><span class="doc">RefAppState</span></a></p>
<p>RefAppState trades safety for performance
and uses <strong>reference semantics</strong> instead of value semantics.</p>
</section>
<hr class="docutils" />
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Slots store <strong>values</strong>, not runtime objects</p></li>
<li><p>All values must be safely deep-copyable</p></li>
<li><p>Primitive structures work out of the box</p></li>
<li><p>Custom classes must extend <strong>CloneableFile</strong></p></li>
<li><p>UI and runtime objects never belong in state</p></li>
</ul>
<p>Once these rules are understood,
SimpleAppState becomes predictable, safe, and scalable.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">simple_app_state</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Core Concepts</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="simple_app_state.html">SimpleAppState</a></li>
<li class="toctree-l2"><a class="reference internal" href="state_slot.html">StateSlot</a></li>
<li class="toctree-l2"><a class="reference internal" href="value_semantics.html">Value Semantics</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Storable Values</a></li>
<li class="toctree-l2"><a class="reference internal" href="batch_updates.html">Batch Updates</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../state_models/index.html">State Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../flutter_integration/index.html">Flutter Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/index.html">Advanced Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../project_management_and_design/index.html">Project Management and Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/index.html">Appendix</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notice.html">Notice</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Core Concepts</a><ul>
      <li>Previous: <a href="value_semantics.html" title="previous chapter">Value Semantics</a></li>
      <li>Next: <a href="batch_updates.html" title="next chapter">Batch Updates</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2026, Masahide Mori.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 9.1.0</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../_sources/core_concepts/storable_values.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>