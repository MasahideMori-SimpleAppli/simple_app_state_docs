<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Using AI Prompts to Design a Screen &#8212; simple_app_state 2026 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=27fed22d" />
    <script src="../_static/documentation_options.js?v=fc6fd62b"></script>
    <script src="../_static/doctools.js?v=fd6eb6e6"></script>
    <script src="../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Appendix" href="../appendix/index.html" />
    <link rel="prev" title="How we work" href="how_we_work.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="using-ai-prompts-to-design-a-screen">
<h1>Using AI Prompts to Design a Screen<a class="headerlink" href="#using-ai-prompts-to-design-a-screen" title="Link to this heading">¶</a></h1>
<p>This chapter explains how to use an AI assistant
to design and implement Flutter screens managed by
<strong>SimpleAppState</strong>, while preserving its mental model
and structural guarantees.</p>
<p>Rather than relying on implicit conventions,
we provide the AI with a <strong>precise operational prompt</strong>
that defines how state may be read, written, and updated.</p>
<p>This approach is especially useful when:</p>
<ul class="simple">
<li><p>Prototyping complex screens</p></li>
<li><p>Refactoring existing widgets</p></li>
</ul>
<hr class="docutils" />
<section id="why-a-dedicated-ai-prompt-is-necessary">
<h2>Why a Dedicated AI Prompt Is Necessary<a class="headerlink" href="#why-a-dedicated-ai-prompt-is-necessary" title="Link to this heading">¶</a></h2>
<p>Generic AI instructions such as <em>“write a Flutter screen”</em> often
lead to incorrect patterns, including:</p>
<ul class="simple">
<li><p>Storing state inside widgets</p></li>
<li><p>Calling setState unnecessarily</p></li>
<li><p>Mutating values returned from <code class="docutils literal notranslate"><span class="pre">slot.get()</span></code></p></li>
<li><p>Updating state during <code class="docutils literal notranslate"><span class="pre">build()</span></code></p></li>
</ul>
<p>SimpleAppState intentionally differs from many common Flutter
state-management approaches.
To avoid subtle but critical mistakes, the AI must be given
<strong>explicit rules describing the state semantics</strong>.</p>
<p>The following prompt serves as a <strong>contract</strong> between you and the AI.</p>
</section>
<hr class="docutils" />
<section id="canonical-ai-prompt">
<h2>Canonical AI Prompt<a class="headerlink" href="#canonical-ai-prompt" title="Link to this heading">¶</a></h2>
<p>Use the following prompt <em>verbatim</em> when asking an AI to implement
a screen using SimpleAppState.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>You are an AI assistant helping to implement a Flutter screen
whose state is managed using the SimpleAppState package.

I will describe the widget structure (UI mock) in the next message.
Your task is to implement the screen logic and state interaction
correctly according to the rules below.

--------------------------------
State Access Rules
--------------------------------

- Widgets may read or write external state only through
  StateSlots declared in `slots`.
- Slot values are retrieved using `slot.get()`.

- If a slot belongs to SimpleAppState,
  `slot.get()` returns a deep copy of the value.
- If a slot belongs to RefAppState,
  `slot.get()` returns a reference.

- Whether a slot belongs to SimpleAppState or RefAppState
  is determined solely by how it was defined
  (`SimpleAppState.slot(...)` or `RefAppState.slot(...)`).
  You must not change or reinterpret this.

--------------------------------
State Update Rules
--------------------------------

- Slot values must be updated using `slot.set(value)`
  or `slot.update((value) =&gt; newValue)`.

- For SimpleAppState:
  the value passed into `update` is already a deep copy.
  You must mutate this value directly and return it.
  Do NOT create another copy.

- For RefAppState:
  the value passed into `update` is a reference.
  RefAppState is explicitly designed for in-place mutation.
  Do NOT create copies here either.

- When a slot is updated, widgets subscribing to that slot
  are rebuilt automatically.
  Do NOT call `setState()`.

--------------------------------
Batch Updates
--------------------------------

- When updating multiple slots together,
  you may use `SimpleAppState.batch(() { ... })`.

- A batch groups multiple slot updates into a single UI rebuild.
- Slot updates inside a batch are applied in declaration order.
  This means that calling `get()` after `set()` inside the same
  batch returns the updated value.

- Always call `batch()` on the correct appState instance
  that owns the slots being updated.

--------------------------------
Custom Classes in Slots
--------------------------------

- Slot values must be JSON-serializable in principle.
  A value is considered JSON-serializable if it is composed only of:
    - primitive types (int, double, bool, String, null)
    - List and Map structures composed recursively of the above.

- If a value cannot be represented using only the structures above,
  it MUST be wrapped in a custom class extending `CloneableFile`
  from the `file_state_manager` package.

- Typical examples that REQUIRE a custom class:
    - DateTime
    - Color
    - Offset, Rect, Size
    - Any Flutter framework class
    - Any domain object with behavior or identity

- Typical examples that do NOT require a custom class:
    - int, double, bool, String
    - enum values stored as String or int
    - List&lt;String&gt;, Map&lt;String, dynamic&gt; composed only of primitives

--------------------------------
CloneableFile Requirements
--------------------------------

- Any custom class stored in a slot MUST extend `CloneableFile`.

- You must implement ALL of the following:

  1. `clone()`
     - Returns a deep copy of the object.
     - All properties must be copied.
     - Nested CloneableFile objects must also be cloned.

  2. `toDict()`
     - Returns a Map&lt;String, dynamic&gt;.
     - The Map may contain only:
         - primitive values
         - null
         - Lists or Maps composed only of primitive values
     - If a property is another custom object,
       it must also extend CloneableFile and be converted via `toDict()`.

  3. `factory fromDict(Map&lt;String, dynamic&gt; src)`
     - Restores all properties from the dictionary produced by `toDict()`.
     - Must be able to fully reconstruct the object.

- Overriding `==` and `hashCode` is strongly recommended
  to ensure correct state comparison and rebuild behavior.

--------------------------------
Deep Copy Semantics
--------------------------------

- Classes extending CloneableFile are automatically deep-copied
  by SimpleAppState, even when nested inside Lists or Maps.

- You must NOT manually create additional copies
  inside `slot.update()`.

--------------------------------
Example
--------------------------------

class AppTimestamp extends CloneableFile {
  final int epochMillis;

  AppTimestamp(this.epochMillis);

  factory AppTimestamp.fromDateTime(DateTime dt) {
    return AppTimestamp(dt.millisecondsSinceEpoch);
  }

  DateTime toDateTime() =&gt;
      DateTime.fromMillisecondsSinceEpoch(epochMillis);

  @override
  AppTimestamp clone() =&gt; AppTimestamp(epochMillis);

  @override
  Map&lt;String, dynamic&gt; toDict() =&gt; {
        &#39;epochMillis&#39;: epochMillis,
      };

  factory AppTimestamp.fromDict(Map&lt;String, dynamic&gt; src) {
    return AppTimestamp(src[&#39;epochMillis&#39;] as int);
  }

  @override
  bool operator ==(Object other) =&gt;
      other is AppTimestamp &amp;&amp; other.epochMillis == epochMillis;

  @override
  int get hashCode =&gt; epochMillis.hashCode;
}

--------------------------------
Non-Serializable &amp; Non-State Objects
--------------------------------

- The following objects must NEVER be stored in slots,
  even if wrapped in a custom class:

    - FocusNode, Stream, Future, callbacks
    - BuildContext
    - Any object tied to the widget lifecycle

- These objects represent runtime behavior or UI control,
  not persistent or logical application state.

- Such objects must be created, owned, and disposed
  within widgets or controllers, not in AppState.

--------------------------------
Forbidden Actions
--------------------------------

- You must NOT call `slot.set()` or `slot.update()` during `build()`.
  Doing so causes infinite rebuild loops.

- All state updates must occur in event handlers,
  such as button callbacks, Futures, or other
  non-build-phase logic.
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="how-to-use-this-prompt">
<h2>How to Use This Prompt<a class="headerlink" href="#how-to-use-this-prompt" title="Link to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p>Copy the prompt above.</p></li>
<li><p>Paste it into your AI tool.</p></li>
<li><p>In the <strong>next message</strong>, describe:</p>
<ul class="simple">
<li><p>The widget tree (mock UI)</p></li>
<li><p>Which slots already exist</p></li>
<li><p>Which interactions should update state</p></li>
</ul>
</li>
<li><p>Review the generated code, focusing on:</p>
<ul class="simple">
<li><p>Slot usage</p></li>
<li><p>Absence of setState</p></li>
<li><p>No updates during build()</p></li>
</ul>
</li>
</ol>
<p>This two-step interaction produces significantly
more reliable and maintainable results.</p>
<p>In the <strong>next message</strong>, for example, we give the AI two files:</p>
<div class="highlight-dart notranslate"><div class="highlight"><pre><span></span><span class="c1">/// Slot definition file. app_state.dart</span>
<span class="k">import</span><span class="w"> </span><span class="s1">&#39;package:simple_app_state/simple_app_state.dart&#39;</span><span class="p">;</span>

<span class="c1">// state and slots</span>
<span class="kd">final</span><span class="w"> </span><span class="n">appState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SimpleAppState</span><span class="p">();</span>
<span class="kd">final</span><span class="w"> </span><span class="n">countSlot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">appState</span><span class="p">.</span><span class="n">slot</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">,</span><span class="w"> </span><span class="nl">initial:</span><span class="w"> </span><span class="m">0</span><span class="p">);</span>
<span class="kd">final</span><span class="w"> </span><span class="n">logsSlot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">appState</span><span class="p">.</span><span class="n">slot</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s1">&#39;logs&#39;</span><span class="p">,</span><span class="w"> </span><span class="nl">initial:</span><span class="w"> </span><span class="p">[],</span><span class="w"> </span><span class="nl">caster:</span><span class="w"> </span><span class="p">(</span><span class="n">raw</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">raw</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">List</span><span class="p">).</span><span class="n">cast</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">());</span>
</pre></div>
</div>
<div class="highlight-dart notranslate"><div class="highlight"><pre><span></span><span class="c1">/// counter_page.dart</span>
<span class="k">import</span><span class="w"> </span><span class="s1">&#39;package:flutter/foundation.dart&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="s1">&#39;package:flutter/material.dart&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="s1">&#39;package:simple_app_state/simple_app_state.dart&#39;</span><span class="p">;</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">CounterPage</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">SlotStatefulWidget</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nd">@override</span>
<span class="w">  </span><span class="n">List</span><span class="o">&lt;</span><span class="n">StateSlot</span><span class="o">&gt;</span><span class="w"> </span><span class="kd">get</span><span class="w"> </span><span class="n">slots</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">[</span><span class="n">countSlot</span><span class="p">,</span><span class="w"> </span><span class="n">logsSlot</span><span class="p">];</span>

<span class="w">  </span><span class="nd">@override</span>
<span class="w">  </span><span class="n">SlotState</span><span class="o">&lt;</span><span class="n">CounterPage</span><span class="o">&gt;</span><span class="w"> </span><span class="n">createState</span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">_CounterPageState</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">_CounterPageState</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">SlotState</span><span class="o">&lt;</span><span class="n">CounterPage</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nd">@override</span>
<span class="w">  </span><span class="n">Widget</span><span class="w"> </span><span class="n">build</span><span class="p">(</span><span class="n">BuildContext</span><span class="w"> </span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">countSlot</span><span class="p">.</span><span class="kd">get</span><span class="p">();</span>
<span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="n">logs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">logsSlot</span><span class="p">.</span><span class="kd">get</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">CreatedNewWidget</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Then tell it to replace CreatedNewWidget() with the actual widget.</p>
<p>You can also ask the AI to add slots or design a data class that extends the Cloneable file.
Please consider this as needed.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">simple_app_state</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core_concepts/index.html">Core Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../state_models/index.html">State Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../flutter_integration/index.html">Flutter Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/index.html">Advanced Topics</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Project Management and Design</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="slot_boundaries.html">Slot Boundaries and Ownership</a></li>
<li class="toctree-l2"><a class="reference internal" href="state_builder_strategy.html">State Builder Strategy</a></li>
<li class="toctree-l2"><a class="reference internal" href="performance_considerations.html">Performance Considerations</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_we_work.html">How we work</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Using AI Prompts to Design a Screen</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/index.html">Appendix</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notice.html">Notice</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Project Management and Design</a><ul>
      <li>Previous: <a href="how_we_work.html" title="previous chapter">How we work</a></li>
      <li>Next: <a href="../appendix/index.html" title="next chapter">Appendix</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2026, Masahide Mori.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 9.1.0</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../_sources/project_management_and_design/ai_prompt.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>