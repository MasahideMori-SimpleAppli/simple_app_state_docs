<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>RefAppState &#8212; simple_app_state 2026 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=27fed22d" />
    <script src="../_static/documentation_options.js?v=fc6fd62b"></script>
    <script src="../_static/doctools.js?v=fd6eb6e6"></script>
    <script src="../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="RefSlot" href="ref_slot.html" />
    <link rel="prev" title="State Models" href="index.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="refappstate">
<h1>RefAppState<a class="headerlink" href="#refappstate" title="Link to this heading">¶</a></h1>
<p><strong>RefAppState</strong> is an alternative state model for SimpleAppState
that works with <strong>reference values instead of deep-copied values</strong>.</p>
<p>It is designed for applications that need to manage
large, mutable, or non-serializable objects such as:</p>
<ul class="simple">
<li><p>3D or 2D scene graphs (e.g. <a class="reference external" href="https://pub.dev/packages/simple_3d">sp3d data</a>)</p></li>
<li><p>vector graphics and shape trees</p></li>
<li><p>large in-memory document or model structures</p></li>
<li><p>engine-level objects that are expensive to clone</p></li>
</ul>
<p>This page explains how <strong>RefAppState</strong> differs from <strong>SimpleAppState</strong>
and when it should be used.</p>
<hr class="docutils" />
<section id="what-refappstate-owns">
<h2>What RefAppState owns<a class="headerlink" href="#what-refappstate-owns" title="Link to this heading">¶</a></h2>
<p>A <strong>RefAppState</strong> instance owns:</p>
<ul class="simple">
<li><p>all application state references</p></li>
<li><p><strong>RefSlot</strong> definitions and their types</p></li>
<li><p>listeners and batch update coordination</p></li>
</ul>
<p>It does <strong>not</strong> own:</p>
<ul class="simple">
<li><p>widgets</p></li>
<li><p>UI-local objects (controllers, animations, focus nodes)</p></li>
<li><p>rendering lifecycle</p></li>
</ul>
<p>As with <strong>SimpleAppState</strong>, state lifetime and ownership
are kept explicit and predictable.</p>
</section>
<hr class="docutils" />
<section id="reference-semantics-instead-of-value-semantics">
<h2>Reference semantics instead of value semantics<a class="headerlink" href="#reference-semantics-instead-of-value-semantics" title="Link to this heading">¶</a></h2>
<p>The fundamental difference from <strong>SimpleAppState</strong> is <strong>how values are stored</strong>.</p>
<p><strong>SimpleAppState</strong>:</p>
<ul class="simple">
<li><p>always stores deep-copied values</p></li>
<li><p>enforces value semantics</p></li>
<li><p>prevents accidental mutation</p></li>
</ul>
<p><strong>RefAppState</strong>:</p>
<ul class="simple">
<li><p>stores <strong>references</strong></p></li>
<li><p>does <strong>not</strong> deep-copy on get, set, or update</p></li>
<li><p>allows direct mutation of stored objects</p></li>
</ul>
<p>This makes <strong>RefAppState</strong> much faster and more flexible,
but also more dangerous if misused.</p>
<p>It should only be used when value semantics are impractical.</p>
</section>
<hr class="docutils" />
<section id="creating-a-refappstate">
<h2>Creating a RefAppState<a class="headerlink" href="#creating-a-refappstate" title="Link to this heading">¶</a></h2>
<p>A <strong>RefAppState</strong> is created just like <strong>SimpleAppState</strong>:</p>
<div class="highlight-dart notranslate"><div class="highlight"><pre><span></span><span class="kd">final</span><span class="w"> </span><span class="n">refState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RefAppState</span><span class="p">();</span>
</pre></div>
</div>
<p>It is usually defined as a global or top-level variable,
often in <strong>ui/ref_state.dart</strong>.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>lib/
├── ui/
│   ├── app_state.dart
│   ├── ref_state.dart # If you use RefAppState, add ref_state.dart.
│   └── pages/
│       └── counter_page.dart  # UI Widgets
└── main.dart               # Entry point
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="refslot-instead-of-stateslot">
<h2>RefSlot instead of StateSlot<a class="headerlink" href="#refslot-instead-of-stateslot" title="Link to this heading">¶</a></h2>
<p><strong>RefAppState</strong> does not use <strong>StateSlot&lt;T&gt;</strong>.</p>
<p>Instead, it provides <strong>RefSlot&lt;T&gt;</strong>:</p>
<div class="highlight-dart notranslate"><div class="highlight"><pre><span></span><span class="kd">final</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">refState</span><span class="p">.</span><span class="n">slot</span><span class="o">&lt;</span><span class="n">MyModel</span><span class="o">&gt;</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span><span class="w"> </span><span class="nl">initial:</span><span class="w"> </span><span class="n">MyModel</span><span class="p">());</span>
</pre></div>
</div>
<p><strong>RefSlot&lt;T&gt;</strong> behaves like <strong>StateSlot&lt;T&gt;</strong>,
but with <strong>reference semantics</strong>.</p>
<p>When you read a value:</p>
<div class="highlight-dart notranslate"><div class="highlight"><pre><span></span><span class="kd">final</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model</span><span class="p">.</span><span class="kd">get</span><span class="p">();</span>
</pre></div>
</div>
<p>You receive the <strong>actual stored object</strong>, not a copy.</p>
<p>Mutating it will immediately affect the state:</p>
<div class="highlight-dart notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="p">.</span><span class="n">vertices</span><span class="p">.</span><span class="n">add</span><span class="p">(...);</span><span class="w">   </span><span class="c1">// modifies state directly</span>
</pre></div>
</div>
<p>This is intentional.</p>
</section>
<hr class="docutils" />
<section id="updating-reference-values">
<h2>Updating reference values<a class="headerlink" href="#updating-reference-values" title="Link to this heading">¶</a></h2>
<p><strong>RefSlot.update</strong> receives the current reference:</p>
<div class="highlight-dart notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="p">.</span><span class="n">update</span><span class="p">((</span><span class="n">m</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">m</span><span class="p">.</span><span class="n">recalculate</span><span class="p">();</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">m</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
<p>The returned object is stored as-is.
No copying is performed.</p>
<p>This allows efficient in-place updates
of large or complex objects.</p>
</section>
<hr class="docutils" />
<section id="safety-trade-offs">
<h2>Safety trade-offs<a class="headerlink" href="#safety-trade-offs" title="Link to this heading">¶</a></h2>
<p>Because <strong>RefAppState</strong> uses references:</p>
<ul class="simple">
<li><p>accidental mutation can corrupt state</p></li>
<li><p>equality comparisons are not structural</p></li>
</ul>
<p>Therefore:</p>
<p><strong>RefAppState</strong> should be treated as a <strong>low-level, performance-oriented state model</strong>.</p>
<p>It is ideal for:</p>
<ul class="simple">
<li><p>geometry editors</p></li>
<li><p>design tools</p></li>
<li><p>large document models</p></li>
</ul>
<p>It is <strong>not</strong> recommended for ordinary UI state.</p>
</section>
<hr class="docutils" />
<section id="snapshots-and-undo">
<h2>Snapshots and undo<a class="headerlink" href="#snapshots-and-undo" title="Link to this heading">¶</a></h2>
<p>Although normal reads and writes use references,
<strong>RefAppState</strong> supports <strong>deep-copy snapshots</strong> for undo and restore.</p>
<div class="highlight-dart notranslate"><div class="highlight"><pre><span></span><span class="kd">final</span><span class="w"> </span><span class="n">snapshot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">refState</span><span class="p">.</span><span class="n">clone</span><span class="p">();</span>
</pre></div>
</div>
<p>A cloned <strong>RefAppState</strong>:</p>
<ul class="simple">
<li><p>deep-copies all stored data</p></li>
<li><p>contains no listeners or UI bindings</p></li>
<li><p>is safe to store in undo stacks</p></li>
</ul>
<p><strong>Important:</strong>
All values stored in a <strong>RefAppState</strong> must still be <em>deep-copyable</em>
in order to use <strong>clone</strong> or <strong>replaceDataFrom</strong>.</p>
<p>Only the following kinds of objects are supported:</p>
<ul class="simple">
<li><p>primitive types (<cite>int</cite>, <cite>double</cite>, <cite>bool</cite>, <cite>String</cite>, <cite>null</cite>)</p></li>
<li><p>JSON-serializable structures (<cite>Map</cite>, <cite>List</cite>, etc)</p></li>
<li><p>classes that implement
<a class="reference external" href="https://pub.dev/documentation/file_state_manager/latest/file_state_manager/CloneableFile-class.html">CloneableFile</a></p></li>
</ul>
<p>If any non-copyable object is stored in a slot,
calling <strong>clone</strong> or <strong>replaceDataFrom</strong> will throw a runtime error.</p>
<p>This is intentional:
it ensures that undo / redo and persistence remain correct and deterministic.</p>
<p>To restore:</p>
<div class="highlight-dart notranslate"><div class="highlight"><pre><span></span><span class="n">refState</span><span class="p">.</span><span class="n">replaceDataFrom</span><span class="p">(</span><span class="n">snapshot</span><span class="p">);</span>
</pre></div>
</div>
<p>This replaces only the stored data,
while preserving:</p>
<ul class="simple">
<li><p>slot definitions</p></li>
<li><p>widget subscriptions</p></li>
<li><p>runtime listeners</p></li>
</ul>
<p>This model is optimized for large mutable objects:
Copy costs are only incurred when creating or restoring a snapshot.</p>
</section>
<hr class="docutils" />
<section id="batch-updates">
<h2>Batch updates<a class="headerlink" href="#batch-updates" title="Link to this heading">¶</a></h2>
<p><strong>RefAppState</strong> supports batch updates
in the same way as <strong>SimpleAppState</strong>:</p>
<div class="highlight-dart notranslate"><div class="highlight"><pre><span></span><span class="n">refState</span><span class="p">.</span><span class="n">batch</span><span class="p">(()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">model</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="n">newModel</span><span class="p">);</span>
<span class="w">  </span><span class="c1">// update other RefSlots</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Batching controls listener notifications and widget rebuilds,
but does <strong>not</strong> affect reference semantics.</p>
</section>
<hr class="docutils" />
<section id="what-refappstate-is-not">
<h2>What RefAppState is not<a class="headerlink" href="#what-refappstate-is-not" title="Link to this heading">¶</a></h2>
<p><strong>RefAppState</strong> is not:</p>
<ul class="simple">
<li><p>safe against accidental mutation</p></li>
<li><p>suitable for small UI state</p></li>
<li><p>a drop-in replacement for <strong>SimpleAppState</strong></p></li>
</ul>
<p>It is a specialized tool for
<strong>large, mutable, performance-critical state</strong>.</p>
<p>Use it only when value semantics are too expensive or impossible.</p>
</section>
<hr class="docutils" />
<section id="api">
<h2>API<a class="headerlink" href="#api" title="Link to this heading">¶</a></h2>
<p><a class="reference external" href="https://pub.dev/documentation/simple_app_state/latest/simple_app_state/RefAppState-class.html">RefAppState</a></p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">simple_app_state</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core_concepts/index.html">Core Concepts</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">State Models</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">RefAppState</a></li>
<li class="toctree-l2"><a class="reference internal" href="ref_slot.html">RefSlot</a></li>
<li class="toctree-l2"><a class="reference internal" href="when_to_use_ref_state.html">When to use RefAppState</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../flutter_integration/index.html">Flutter Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/index.html">Advanced Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../project_management_and_design/index.html">Project Management and Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/index.html">Appendix</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notice.html">Notice</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">State Models</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">State Models</a></li>
      <li>Next: <a href="ref_slot.html" title="next chapter">RefSlot</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2026, Masahide Mori.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 9.1.0</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../_sources/state_models/ref_app_state.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>